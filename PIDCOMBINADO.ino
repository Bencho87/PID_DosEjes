//Encoder #1
const int pinCanalA=3;
const int pinCanalB=5;
//Control Motor 1
const int motorPin1=8;
const int motorPin2=9;

//Encoder #2
const int pinCanalA2=2;
const int pinCanalB2=4;

//Control Motor 2
const int motorPin12=11;
const int motorPin22=10;



float dt=0.02;
float tiempo=0;
float contador=0;
float contador2=0;
float pos=0;
float pos_ant=0;
float vel=0;
float VMotor=0;
float valorM=0;

String refstring="";
float referencia=0;
float referencia2=0;

int flagx = 0;
int indexref = 0;
int indexr = 0;

float e[3]={0.0,0.0,0.0};
//e[0] error actual       e[1] error anterior    e[2] error dos veces ant
float u[2]={0.0,0.0};
//u[0] salida actual   u[1]  salida anterior
float kp,ki,kd;//ganancias del modelo continuo
float kp2,ki2,kd2;//ganancias del modelo continuo
float Ts; //periodo de muestreo
float K1,K2,K3;//ganancias del modelo discreto
float K12,K22,K32;//ganancias del modelo discreto


//piddos

float e2[3]={0.0,0.0,0.0};
//e[0] error actual       e[1] error anterior    e[2] error dos veces ant
float u2[2]={0.0,0.0};

//circuleishon
float ref1[]={-12.3200457421717,-9.84830773205214,-7.39372258248961,-4.95726572140139,-2.53991987236221,-0.142674592067137,2.23347428976117,4.58752533286005,6.91847225584754,9.22530481670665,11.5070098079549,13.7625721694857,15.9909762213190,18.1912070176147,20.3622518222912,22.5031017054419,24.6127532584751,26.6902104244958,28.7344864389458,30.7446058739010,32.7196067777377,34.6585429001270,36.5604859905458,38.4245281567067,40.2497842675834,42.0353943840447,43.7805261985756,45.4843774641917,47.1461783914969,48.7651939919127,50.3407263445044,51.8721167635245,53.3587478438758,54.8000453621320,56.1954800116035,57.5445689511687,58.8468771492173,60.1020185060484,61.3096567404026,62.4695060284337,63.5813313863184,64.6449487907623,65.6602250348598,66.6270773200187,67.5454725878872,68.4154265993732,69.2370027708317,70.0103107802778,70.7355049589776,71.4127824859598,72.0423814048106,72.6245784835782,73.1596869396537,73.6480540521650,74.0900586846922,74.4861087410090,74.8366385761153,75.1421063840734,75.4029915831233,75.6197922173010,75.7930223923249,75.9232097619288,76.0108930791165,76.0566198250654,76.0609439266230,76.0244235715804,75.9476191291828,75.8310911816897,75.6753986712311,75.4810971647538,75.2487372385195,74.9788629823999,74.6720106231474,74.3287072648666,73.9494697441060,73.5348035963011,73.0852021297309,72.6011456027115,72.0831004993929,71.5315188992866,70.9468379354873,70.3294793364721,69.6798490463474,68.9983369184583,68.2853164773748,67.5411447444108,66.7661621220062,65.9606923325083,65.1250424071194,64.2595027210186,63.3643470709266,62.4398327916490,61.4862009084014,60.5036763219942,59.4924680242270,58.4527693411101,57.3847582017930,56.2885974313431,55.1644350657623,54.0124046878759,52.8326257829676,51.6252041132504,50.3902321104956,49.1277892863399,47.8379426600010,46.5207472033210,45.1762463032436,43.8044722420107,42.4054466955348,40.9791812505648,39.5256779414243,38.0449298072506,36.5369214708067,35.0016297400804,33.4390242340133,31.8490680338346,30.2317183615935,28.5869272875966,26.9146424685718,25.2148079184744,23.4873648139531,21.7322523365729,19.9494085539760,18.1387713422240,16.3002793516258,14.4338730183946,12.5394956245144,10.6170944082036,8.66662172736440,6.68803627838373,4.68130437260205,2.64640127270067,0.583312591156664,-1.50796424721479,-3.62741847677036,-5.77502439494903,-7.95073969716491,-10.1545037415617,-12.3862357428377,-14.6458328947468,-16.9331684213256,-19.2480895574097,-21.5904154595791,-23.9599350493109,-26.3564047908513,-28.7795464070941,-31.2290445376449,-33.7045443441928,-36.2056490693484,-38.7319175562300,-41.2828617372666,-43.8579441019650,-46.4565751547316,-49.0781108752466,-51.7218501953562,-54.3870325079535,-57.0728352248619,-59.7783714022835,-62.5026874539219,-65.2447609733958,-68.0034986890258,-70.7777345754321,-73.5662281476403,-76.3676629644723,-79.1806453689053,-82.0037034937361,-84.8352865612760,-87.6737645058663,-90.5174279477085,-93.3644885458052,-96.2130797566740,-99.0612580238900,-101.907004421394,-104.748226770893,-107.582762250491,-110.408380508027,-113.222787288340,-116.023628579000,-118.808495273818,-121.574928347916,-124.320424532122,-127.042442468339,-129.738409321108,-132.405727814188,-135.041783654606,-137.643953300450,-140.209612022801,-142.736142206799,-145.220941832008,-147.661433068085,-150.055070918490,-152.399351842535,-154.691822284718,-156.930087039890,-159.111817383638,-161.234758899021,-163.296738933822,-165.295673626406,-167.229574443200,-169.096554176681,-170.894832359220,-172.622740055438,-174.278724003222,-175.861350081649,-177.369306092058,-178.801403846664,-180.156580567003,-181.433899602098,-182.632550483426,-183.751848340311,-184.791232705377,-185.750265744833,-186.628629952856,-187.426125352892,-188.142666251506,-188.778277592374,-189.333090959172,-189.807340276540,-190.201357258040,-190.515566649108,-190.750481311525,-190.906697194019,-190.984888231218,-190.985801210509,-190.910250643444,-190.759113675205,-190.533325062422,-190.233872246414,-189.861790545615,-189.418158487792,-188.904093299540,-188.320746567593,-187.669300083649,-186.950961881814,-186.166962475320,-185.318551296944,-184.406993345528,-183.433566039211,-182.399556274356,-181.306257687756,-180.154968118495,-178.946987264801,-177.683614530376,-176.366147053955,-174.995877915334,-173.574094510624,-172.102077089220,-170.581097444748,-169.012417752145,-167.397289542999,-165.736952811331,-164.032635242061,-162.285551554618,-160.496902954276,-158.667876684087,-156.799645670502,-154.893368256063,-152.950188012833,-150.971233630541,-148.957618873730,-146.910442602483,-144.830788851643,-142.719726963733,-140.578311771075,-138.407583822915,-136.208569653631,-133.982282088379,-131.729720582797,-129.451871593612,-127.149708977279,-124.824194413934,-122.476277854229,-120.106897986742,-117.716982723895,-115.307449704431,-112.879206810711,-110.433152699168,-107.970177342452,-105.491162581864,-102.996982688803,-100.488504934041,-97.9665901637119,-95.4320933809633,-92.8858643322907,-90.3287480975889,-87.7615856830076,-85.1852146157007,-82.6004695395697,-80.0081828110926,-77.4091850943078,-74.8043059539961,-72.1943744460488,-69.5802197039658,-66.9626715203434,-64.3425609221405,-61.7207207384052,-59.0979861590427,-56.4751952830757,-53.8531896547178,-51.2328147854273,-48.6149206599505,-46.0003622241830,-43.3899998525014,-40.7846997920059,-38.1853345809208,-35.5927834381705,-33.0079326209343,-30.4316757467441,-27.8649140764653,-25.3085567542598,-22.7635210004066,-20.2307322526279,-17.7111242513612,-15.2056390642193,-12.7152270447135};
float ref2[]={71.0831055658915,70.4789342526683,69.8843224464414,69.2996005996685,68.7251032575984,68.1611688041695,67.6081391668949,67.0663594786523,66.5361776944273,66.0179441612333,65.5120111396508,65.0187322757007,64.5384620220892,64.0715550082384,63.6183653589543,63.1792459620703,62.7545476859532,62.3446185483573,61.9498028387538,61.5704401969591,61.2068646516020,60.8594036227205,60.5283768935385,60.2140955572300,59.9168609452204,59.6369635442816,59.3746819103343,59.1302815874542,58.9040140410750,58.6961156147686,58.5068065202463,58.3362898703451,58.1847507647357,58.0523554378944,57.9392504785202,57.8455621290508,57.7713956732332,57.7168349188519,57.6819417817200,57.6667559759117,57.6712948139833,57.6955531196167,57.7395032537558,57.8030952539134,57.8862570849490,57.9888949982684,58.1108939951217,58.2521183884869,58.4124124569577,58.5916011831219,58.7894910681332,59.0058710135579,59.2405132611293,59.4931743807577,59.7635962970254,60.0515073444415,60.3566233419166,60.6786486772402,61.0172773927857,61.3721942642023,61.7430758644776,62.1295916064319,62.5314047574346,62.9481734208814,63.3795514797330,63.8251894981717,64.2847355781701,64.7578361684723,65.2441368241630,65.7432829156183,66.2549202862135,66.7786958586781,67.3142581904557,67.8612579788348,68.4193485169684,68.9881861021986,69.5674303983520,70.1567447538659,70.7557964777653,71.3642570756172,71.9818024476701,72.6081130514247,73.2428740309002,73.8857753148451,74.5365116861113,75.1947828243603,75.8602933242007,76.5327526907853,77.2118753148034,77.8973804287151,78.5889920459750,79.2864388848903,79.9894542786603,80.6977760730365,81.4111465129476,82.1293121193304,82.8520235573132,83.5790354968065,84.3101064664658,85.0449987019076,85.7834779889802,86.5253135028151,87.2702776433132,88.0181458676580,88.7686965203812,89.5217106614559,90.2769718928360,91.0342661838145,91.7933816955317,92.5541086049232,93.3162389283636,94.0795663452297,94.8438860215816,95.6089944341329,96.3746891946628,97.1407688750053,97.9070328327344,98.6732810376562,99.4393138992062,100.204932094848,100.969936399566,101.734127516539,102.497305909095,103.259271634045,104.019824176490,104.778762286237,105.535883815933,106.290985561076,107.043863102050,107.794310648371,108.542120885347,109.287084823378,110.028991650146,110.767628585990,111.502780742773,112.234230986600,112.961759804773,113.685145177414,114.404162454230,115.118584236935,115.828180267894,116.532717325602,117.231959127666,117.925666241996,118.613596006994,119.295502461549,119.971136285728,120.640244753102,121.302571695688,121.957857482563,122.605839013239,123.246249726939,123.878819628980,124.503275335459,125.119340137537,125.726734086574,126.325174101433,126.914374099246,127.494045150945,128.063895662828,128.623631585387,129.172956650589,129.711572638706,130.239179675695,130.755476562024,131.260161133672,131.752930655887,132.233482250060,132.701513353877,133.156722214646,133.598808415407,134.027473433153,134.442421228132,134.843358862877,135.229997149212,135.602051321112,135.959241730881,136.301294565733,136.627942581422,136.938925849191,137.233992511926,137.512899545033,137.775413517219,138.021311346094,138.250381043220,138.462422443097,138.657247910408,138.834683019800,138.994567202508,139.136754354205,139.261113398650,139.367528801964,139.455901032707,139.526146963334,139.578200209140,139.612011401315,139.627548391383,139.624796384973,139.603758003539,139.564453273418,139.506919542324,139.431211324142,139.337400073588,139.225573893012,139.095837174263,138.948310179154,138.783128562595,138.600442842931,138.400417824439,138.183231977230,137.949076780047,137.698156031620,137.430685136280,137.146890369544,136.847008129320,136.531284178192,136.199972882084,135.853336450316,135.491644181765,135.115171721505,134.724200331931,134.319016181993,133.899909657735,133.467174696976,133.021108150508,132.562009171857,132.090178637194,131.605918596697,131.109531758237,130.601321004016,130.081588940430,129.550637481180,129.008767463424,128.456278296529,127.893467642790,127.320631129343,126.738062090336,126.146051338334,125.544886963817,124.934854161580,124.316235082795,123.689308711437,123.054350763789,122.411633609718,121.761426214425,121.103994099392,120.439599321280,119.768500467558,119.090952667689,118.407207618742,117.717513624355,117.022115646012,116.321255365664,115.615171258780,114.904098676947,114.188269939225,113.467914431501,112.743258713132,112.014526630235,111.281939435025,110.545715910649,109.806072501020,109.063223445170,108.317380915742,107.568755161200,106.817554651451,106.063986226549,105.308255248213,104.550565753924,103.791120613357,103.030121686976,102.267769986604,101.504265837820,100.739809044041,99.9745990521670,99.2088351196755,98.4427164830624,97.6764425275324,96.9102129578454,96.1442279702293,95.3786884252645,94.6137960216462,93.8497534707202,93.0867646716807,92.3250348873062,91.5647709200930,90.8061812886287,90.0494764040270,89.2948687462171,88.5425730398556,87.7928064295951,87.0457886544064,86.3017422206135,85.5608925732529,84.8234682653237,84.0897011244387,83.3598264163290,82.6340830045961,81.9127135060324,81.1959644407634,80.4840863763872,79.7773340652044,79.0759665735477,78.3802474021280,77.6904445962253,77.0068308444474,76.3296835646898,75.6592849758201,74.9959221535139,74.3398870685637,73.6914766058853,73.0509925623450,72.4187416214466,71.7950353028239,71.1801898844202};

// cuadrado sin perfil
//float ref1[]={-57.6543994941556,-57.4658510405792,-57.2747220600951,-57.0810122772328,-56.8847212971580,-56.6858486043594,-56.4843935613107,-56.2803554071074,-56.0737332560774,-55.8645260963651,-55.6527327884888,-55.4383520638681,-55.2213825233235,-55.0018226355458,-54.7796707355343,-54.5549250230035,-54.3275835607562,-54.0976442730249,-53.8651049437762,-53.6299632149814,-53.3922165848492,-53.1518624060216,-52.9088978837297,-52.6633200739108,-52.4151258812834,-52.1643120573803,-51.9108751985377,-51.6548117438400,-51.3961179730177,-51.1347900042980,-50.8708237922067,-50.6042151253192,-50.3349596239603,-50.0630527378496,-49.7884897436926,-49.5112657427151,-49.2313756581390,-48.9488142325978,-48.6635760254912,-48.3756554102748,-48.0850465716845,-47.7917435028939,-47.4957400026007,-47.1970296720428,-46.8956059119385,-46.5914619193527,-46.2845906844820,-45.9749849873610,-45.6626373944827,-45.3475402553349,-45.0296856988457,-44.7090656297389,-44.3856717247939,-44.0594954290075,-43.7305279516566,-43.3987602622551,-43.0641830864049,-42.7267869015347,-42.3865619325258,-42.0434981472192,-41.6975852518001,-41.3488126860572,-40.9971696185113,-40.6426449414094,-40.2852272655795,-39.9249049151423,-39.5616659220732,-39.1954980206111,-38.8263886415083,-38.4543249061155,-38.0792936202965,-37.7012812681674,-37.3202740056523,-36.9362576538509,-36.5492176922113,-36.1591392514977,-35.7660071065511,-35.3698056688314,-34.9705189787330,-34.5681306976692,-34.1626240999116,-33.7539820641806,-33.3421870649733,-32.9272211636222,-32.5090659990724,-32.0877027783678,-31.6631122668337,-31.2352747779464,-30.8041701628749,-30.3697777996832,-29.9320765821810,-29.4910449084053,-29.0466606687226,-28.5989012335321,-28.1477434405571,-27.6931635817052,-27.2351373894814,-26.7736400229340,-26.3086460531156,-25.8401294480353,-25.3680635570851,-24.8924210949144,-24.4131741247300,-23.9302940409962,-23.4437515515101,-22.9535166588220,-22.4595586409737,-21.9618460315238,-21.4603465988264,-20.9550273245304,-20.4458543812628,-19.9327931094592,-19.4158079932988,-18.8948626357059,-18.3699197323685,-17.8409410447311,-17.3078873719090,-16.7707185214721,-16.2293932790439,-15.6838693766539,-15.1341034597833,-14.5800510530359,-14.0216665243649,-13.4589030477807,-12.8917125644600,-12.8917125644600,-11.8996753785802,-10.9056400341077,-9.90958120999442,-8.91147304311021,-7.91128911449670,-6.90900243513802,-5.90458543122771,-4.89800992891124,-3.88924713848020,-2.87826763799436,-1.86504135630693,-0.849537555465048,0.168275187540773,1.18842899970860,2.21095673167012,3.23589197808077,4.26326909878897,5.29312324082289,6.32549036123137,7.36040725082030,8.39791155882791,9.43804181858430,10.4808374742023,11.5263389083523,12.5745874711726,13.6256255103760,14.6794964026084,15.7362445861266,16.7959155948645,17.8585560939558,18.9242139167939,19.9929381037078,21.0647789423435,22.1397880098397,23.2180182168993,24.2995238538595,25.3843606388719,26.4725857683134,27.5642579695525,28.6594375562085,29.7581864860469,30.8605684216683,31.9666487941544,33.0764948698493,34.1901758204681,35.3077627967349,36.4293290057709,37.5549497924673,38.6847027250964,39.8186676854341,40.9569269636860,42.0995653585333,43.2466702826412,44.3983318739961,45.5546431134704,46.7156999490461,47.8816014271619,49.0524498316900,50.2283508310902,51.4094136343373,52.5957511562670,53.7874801930479,54.9847216085418,56.1876005323965,57.3962465707781,58.6107940307469,59.8313821593704,61.0581553987726,62.2912636584356,63.5308626062036,64.7771139795797,66.0301859190739,67.2902533255382,68.5574982436349,69.8321102738104,71.1142870154058,72.4042345438304,73.7021679250526,75.0083117710369,76.3229008401807,77.6461806872882,78.9784083681677,80.3198532045690,81.6707976158986,83.0315380249779,84.4023858460605,85.7836685644294,87.1757309181641,88.5789361941493,89.9936676521178,91.4203300925354,92.8593515864907,94.3111853885318,95.7763120566645,97.2552418076121,98.7485171400514,100.256715764059,101.780453881622,103.320389871038,104.877228437704,106.451725305537,108.044692537661,109.657004592724,111.289605245069,112.943515524345,114.619842864329,116.319791693964,118.044675758630,119.795932530206,121.575140155733,123.384037513703,125.224548104115,127.098808707961,129.009204034281,130.958408958607,132.949440490542,134.985722358294,137.071166169253,139.210274663483,141.408274887915,143.671292624626,146.006584858952,148.422855796690,150.930696354282,153.543211765151,151.519272824705,149.600918000904,147.775122952821,146.031358476340,144.360968667116,142.756735196098,141.212563831203,139.723253729296,138.284324257956,136.891882728103,135.542521810800,134.233238880464,132.961371814679,131.724547323837,130.520638945332,129.347732580663,128.204097983181,127.088164986870,125.998503546796,124.933806869808,123.892877070070,122.874612902385,121.877999216856,120.902097848573,119.946039710618,119.009017901648,118.090281673339,117.189131130102,116.304912555278,115.437014275610,114.584862990111,113.747920501139,112.925680795091,112.117667428073,111.323431178493,110.542547933990,109.774616784739,109.019258299015,108.276112960156,107.544839746849,106.825114840983,106.116630449349,105.419093727142,104.732225792732,104.055760824415,103.389445230958,102.733036888696,102.086304438776,101.449026638845,100.820991764118,100.201997053299,99.5918481953253,98.9903588533067,98.3973502224293,97.8126506188966,97.2360950972919,96.6675250939947,96.1067880945136,95.5537373228051,95.0082314508262,94.4701343267343,93.9393147202896,93.4156460841499,92.8990063298582,92.3892776174358,91.8863461575809,91.3901020255646,90.9004389859860,90.4172543276246,89.9404487076862,89.4699260047960,89.0055931801484,88.5473601462639,88.0951396428516,87.6488471193101,87.2084006234407,86.7737206959731,86.3447302705380,85.9213545787454,85.5035210600543,85.0911592761408,84.6842008294922,84.2825792859756,83.8862301011458,83.4950905500733,83.1090996604893,82.7281981490580,82.3523283605974,81.9814342100857,81.6154611272956,81.2543560039156,80.8980671430191,80.5465442107575,80.1997381901572,79.8576013369102,79.5200871370525,79.1871502664342,78.8587465518875,78.5348329340066,78.2153674314594,77.9003091067525,77.5896180333786,77.2832552642781,76.9811828015508,76.6833635673584,76.3897613759582,76.1003409068178,75.8150676787574,75.5339080250722,75.2568290695909,74.9837987036255,74.7147855637732,74.4497590105314,74.1886891076895,73.9315466024627,73.6783029063357,73.4289300765849,73.1834007984491,72.9416883679228,72.7037666751424,72.4696101883426,72.2391939383592,72.0124935036526,71.7894849958338,70.6663937269438,69.5461058523885,68.4285657257579,67.3137189515905,66.2015123447934,65.0918938917443,63.9848127129954,62.8802190274970,61.7780641182673,60.6783002994378,59.5808808846083,58.4857601564482,57.3928933374868,56.3022365620335,55.2137468491789,54.1273820768245,53.0431009566960,51.9608630102919,50.8806285457301,49.8023586354487,48.7260150947251,47.6515604609760,46.5789579738063,45.5081715557726,44.4391657938324,43.3719059214474,42.3063578013168,41.2424879087104,40.1802633153800,39.1196516740236,38.0606212032791,37.0031406732271,35.9471793913835,34.8927071891596,33.8396944087727,32.7881118905901,31.7379309608875,30.6891234200088,29.6416615309086,28.5955180080651,27.5506660067483,26.5070791126305,25.4647313317262,24.4235970806492,23.3836511771756,22.3448688311001,21.3072256353781,20.2706975575384,19.2352609313627,18.2008924488170,17.1675691522302,16.1352684267081,15.1039679927765,14.0736458992465,13.0442805162900,12.0158505287239,10.9883349294914,9.96171301333686,8.93596437066610,7.91106888158593,6.88700671011843,5.86375829858315,4.84130436214173,3.81962588350036,2.79870410776511,1.77852053744419,0.759056927594001,-0.259704718896761,-1.27778215588837,-2.29519289844113,-3.31195422714068,-4.32808319230014,-5.34359661804435,-6.35851110627838,-7.37284304054495,-8.38660858977239,-9.39982371191845,-10.4125041575111,-11.4246654730904,-12.4363230045539,-13.4474919004079,-14.4581871149286,-15.4684234112335,-16.4782153642683,-17.4875773637078,-18.4965236167783,-19.5050681509979,-20.5132248168421,-21.5210072903327,-22.5284290755545,-23.5355035071013,-24.5422437524512,-25.5486628142758,-26.5547735326832,-27.5605885873970,-28.5661204998721,-29.5713816353515,-30.5763842048617,-31.5811402671514,-32.5856617305731,-33.5899603549104,-34.5940477531508,-35.5979353932057,-36.6016345995806,-37.6051565549938,-38.6085123019466,-39.6117127442459,-40.6147686484807,-41.6176906454515,-42.6204892315568,-43.6231747701346,-44.6257574927627,-45.6282475005156,-46.6306547651823,-47.6329891304429,-48.6352603130076,-49.6374779037154,-50.6396513685974,-51.6417900499024,-52.6439031670870,-53.6459998177701,-54.6480889786534,-55.6501795064084,-56.6522801385297,-57.6543994941556};
//float ref2[]={104.706417525038,104.489446757001,104.271810726191,104.053507233561,103.834534036414,103.614888847853,103.394569336222,103.173573124534,102.951897789882,102.729540862849,102.506499826892,102.282772117723,102.058355122669,101.833246180025,101.607442578388,101.380941555978,101.153740299944,100.925835945654,100.697225575973,100.467906220517,100.237874854900,100.007128399956,99.7756637209484,99.5434776267589,99.3105668690596,99.0769281414652,98.8425580786661,98.6074532555414,98.3716101862517,98.1350253233101,97.8976950566326,97.6596157125650,97.4207835528882,97.1811947737988,96.9408455048661,96.6997318079643,96.4578496761788,96.2151950326861,95.9717637296069,95.7275515468315,95.4825541908158,95.2367672933482,94.9901864102866,94.7428070202628,94.4946245233565,94.2456342397343,93.9958314082556,93.7452111850433,93.4937686420175,93.2414987653927,92.9883964541359,92.7344565183851,92.4796736778271,92.2240425600327,91.9675576987487,91.7102135321447,91.4520044010141,91.1929245469262,90.9329681103305,90.6721291286086,90.4104015340742,90.1477791519193,89.8842556981029,89.6198247771834,89.3544798800897,89.0882143818315,88.8210215391452,88.5528944880736,88.2838262414774,88.0138096864763,87.7428375818163,87.4709025551617,87.1979971003092,86.9241135743199,86.6492441945688,86.3733810357059,86.0965160265284,85.8186409467590,85.5397474237278,85.2598269289544,84.9788707746249,84.6968701099629,84.4138159174874,84.1296990091555,83.8445100223843,83.5582394159487,83.2708774657487,82.9824142604429,82.6928396969409,82.4021434757518,82.1103150961808,81.8173438513683,81.5232188231669,81.2279288768473,80.9314626556277,80.6338085750195,80.3349548169812,80.0348893238719,79.7335997921983,79.4310736661438,79.1272981308723,78.8222601055959,78.5159462363977,78.2083428887975,77.8994361400498,77.5892117711629,77.2776552586257,76.9647517658293,76.6504861341705,76.3348428738207,76.0178061541478,75.6993597937712,75.3794872502369,75.0581716092905,74.7353955737331,74.4111414518366,74.0853911452992,73.7581261367179,73.4293274765539,73.0989757695664,72.7670511606874,72.4335333203092,72.0984014289557,71.7616341613037,71.4232096695220,71.4232096695220,71.1797039487257,70.9349479054764,70.6889307325355,70.4416413977573,70.1930686381393,69.9432009536677,69.6920266009466,69.4395335866043,69.1857096604647,68.9305423084751,68.6740187453793,68.4161259071232,68.1568504429836,67.8961787074053,67.6340967515342,67.3705903144327,67.1056448139619,66.8392453373151,66.5713766311875,66.3020230915626,66.0311687530987,65.7587972780948,65.4848919450172,65.2094356365626,64.9324108272372,64.6537995704253,64.3735834849236,64.0917437409120,63.8082610453332,63.5231156266501,63.2362872189467,62.9477550453410,62.6574978006688,62.3654936334032,62.0717201267638,61.7761542789751,61.4787724826227,61.1795505030600,60.8784634558079,60.5754857828930,60.2705912280597,59.9637528107919,59.6549427990727,59.3441326808068,59.0312931338239,58.7163939943769,58.3994042240402,58.0802918749090,57.7590240529906,57.4355668796725,57.1098854511410,56.7819437956176,56.4517048282650,56.1191303036085,55.7841807653016,55.4468154930520,55.1069924465114,54.7646682059109,54.4197979092116,54.0723351855135,53.7222320844505,53.3694390012675,53.0139045972565,52.6555757151917,52.2943972893768,51.9303122498769,51.5632614204685,51.1931834097990,50.8200144951912,50.4436884984792,50.0641366531954,49.6812874623603,49.2950665460518,48.9053964778373,48.5121966090615,48.1153828798658,47.7148676156958,47.3105593079094,46.9023623769412,46.4901769162953,46.0738984154367,45.6534174594135,45.2286194027761,44.7993840150537,44.3655850946932,43.9270900479618,43.4837594288485,43.0354464354511,42.5819963577138,42.1232459706415,41.6590228662624,41.1891447166070,40.7134184587902,40.2316393918882,39.7435901736522,39.2490397031323,38.7477418729410,38.2394341720677,37.7238361167590,37.2006474828748,36.6695463081196,36.1301866264347,35.5821958892979,35.0251720193588,34.4586800302223,33.8822481316332,33.2953632209262,32.6974656382105,32.0879430327487,31.4661231491701,30.8312652914651,30.1825501558627,29.5190676345950,28.8398020724082,28.1436142936494,27.4292194906942,26.6951597454981,25.9397695004838,25.1611316325548,24.3570208013357,23.5248292521109,22.6614679355551,21.7632320971655,20.8256143605133,19.8430378185728,20.8234170857686,21.7590200079822,22.6553903653184,23.5170105661823,24.3475661022893,25.1501308637507,25.9273004696867,26.6812903997485,27.4140096593551,28.1271170456070,28.8220647880368,29.5001328633110,30.1624563100765,30.8100472140000,31.4438125816185,32.0645690053991,32.6730547972502,33.2699401050053,33.8558354071950,34.4312986929914,34.9968415678466,35.5529344750110,36.1000111845654,36.6384726717839,37.1686904834072,37.6910096721266,38.2057513651114,38.7132150208679,39.2136804194466,39.7074094235294,40.1946475418363,40.6756253213188,41.1505595905161,41.6196545730762,42.0831028876385,42.5410864479424,42.9937772750678,43.4413382320720,43.8839236898969,44.3216801322488,44.7547467061514,45.1832557240183,45.6073331223660,46.0270988816581,46.4426674112316,46.8541479027929,47.2616446555636,47.6652573758066,48.0650814531603,48.4612082159353,48.8537251673030,49.2427162040923,49.6282618197370,50.0104392927550,50.3893228619993,50.7649838898000,51.1374910140032,51.5069102898182,51.8733053222944,52.2367373901755,52.5972655618055,52.9549468037026,53.3098360823595,53.6619864597801,54.0114491832166,54.3582737695333,54.7025080845829,55.0441984179531,55.3833895534092,55.7201248353300,56.0544462314147,56.3863943919118,56.7160087056035,57.0433273527602,57.3683873552639,57.6912246240813,58.0118740042589,58.3303693175939,58.6467434031276,58.9610281555945,59.2732545619524,59.5834527361101,59.8916519519588,60.1978806748077,60.5021665913186,60.8045366380242,61.1050170285120,61.4036332793504,61.7004102348246,61.9953720905525,62.2885424160378,62.5799441762215,62.8695997520835,63.1575309603463,63.4437590723277,63.7283048319868,64.0111884732056,64.2924297363448,64.5720478841120,64.8500617167750,65.1264895867545,65.4013494126267,65.6746586925639,65.9464345172409,66.2166935822336,66.4854521999330,66.7527263109980,67.0185314953688,67.2828829828614,67.5457956633619,67.8072840966398,68.0673625217970,68.3260448663692,68.5833447550951,68.8392755183680,69.0938502003842,69.3470815670009,69.5989821133166,69.8495640709855,70.0988394152777,70.3468198718953,70.5935169235558,70.8389418163509,71.0831055658915,71.4232096695220,71.7616341613037,72.0984014289557,72.4335333203092,72.7670511606874,73.0989757695664,73.4293274765539,73.7581261367179,74.0853911452992,74.4111414518366,74.7353955737331,75.0581716092905,75.3794872502369,75.6993597937712,76.0178061541478,76.3348428738207,76.6504861341705,76.9647517658293,77.2776552586257,77.5892117711629,77.8994361400498,78.2083428887975,78.5159462363977,78.8222601055959,79.1272981308723,79.4310736661438,79.7335997921983,80.0348893238719,80.3349548169812,80.6338085750195,80.9314626556277,81.2279288768473,81.5232188231669,81.8173438513683,82.1103150961808,82.4021434757518,82.6928396969409,82.9824142604429,83.2708774657487,83.5582394159487,83.8445100223843,84.1296990091555,84.4138159174874,84.6968701099629,84.9788707746249,85.2598269289544,85.5397474237278,85.8186409467590,86.0965160265284,86.3733810357059,86.6492441945688,86.9241135743199,87.1979971003092,87.4709025551617,87.7428375818163,88.0138096864763,88.2838262414774,88.5528944880736,88.8210215391452,89.0882143818315,89.3544798800897,89.6198247771834,89.8842556981029,90.1477791519193,90.4104015340742,90.6721291286086,90.9329681103305,91.1929245469262,91.4520044010141,91.7102135321447,91.9675576987487,92.2240425600327,92.4796736778271,92.7344565183851,92.9883964541359,93.2414987653927,93.4937686420175,93.7452111850433,93.9958314082556,94.2456342397343,94.4946245233565,94.7428070202628,94.9901864102866,95.2367672933482,95.4825541908158,95.7275515468315,95.9717637296069,96.2151950326861,96.4578496761788,96.6997318079643,96.9408455048661,97.1811947737988,97.4207835528882,97.6596157125650,97.8976950566326,98.1350253233101,98.3716101862517,98.6074532555414,98.8425580786661,99.0769281414652,99.3105668690596,99.5434776267589,99.7756637209484,100.007128399956,100.237874854900,100.467906220517,100.697225575973,100.925835945654,101.153740299944,101.380941555978,101.607442578388,101.833246180025,102.058355122669,102.282772117723,102.506499826892,102.729540862849,102.951897789882,103.173573124534,103.394569336222,103.614888847853,103.834534036414,104.053507233561,104.271810726191,104.489446757001,104.706417525038};

//float ref1[]={-94.4645478117226,-94.4554138718072,-94.4416910502552,-94.4233530615596,-94.4003648725166,-94.3726827142659,-94.3402540972412,-94.3030178289672,-94.2609040346208,-94.2138341802618,-94.1617210986341,-94.1044690174050,-94.0419735897181,-93.9741219269041,-93.9007926331893,-93.8218558422220,-93.7371732552241,-93.6465981805587,-93.5499755744907,-93.4471420828990,-93.3379260836838,-93.2221477295968,-93.0996189912009,-92.9701436996538,-92.8335175889874,-92.6895283375347,-92.5379556081423,-92.3785710867797,-92.2111385191376,-92.0354137447882,-91.8511447284504,-91.6580715878879,-91.4559266179316,-91.2444343101027,-91.0233113672738,-90.7922667127842,-90.5510014933878,-90.2992090753809,-90.0365750332224,-89.7627771299184,-89.4774852884013,-89.1803615530960,-88.8710600408088,-88.5492268800318,-88.2145001376954,-87.8665097323453,-87.5048773326520,-87.1292162400939,-86.7391312545743,-86.3342185216532,-85.9223729677235,-85.5035969794638,-85.0778919188006,-84.6452581088061,-84.2056948190445,-83.7592002503392,-83.3057715189362,-82.8454046400344,-82.3780945106550,-81.9038348918165,-81.4226183899890,-80.9344364377883,-80.4392792738789,-79.9371359220484,-79.4279941694143,-78.9118405437237,-78.3886602897027,-77.8584373444126,-77.3211543115642,-76.7767924347434,-76.2253315694938,-75.6667501542039,-75.1010251797405,-74.5281321577670,-73.9597175063486,-73.3961791145177,-72.8379079984528,-72.2852883866003,-71.7386977902371,-71.1985070598701,-70.6650804278814,-70.1387755378304,-69.6199434608400,-69.1089286994989,-68.6060691797310,-68.1116962310891,-67.6261345559507,-67.1497021881039,-66.6827104412318,-66.2254638478149,-65.7782600889932,-65.3413899159431,-64.9151370633410,-64.4997781555061,-64.0955826058257,-63.7028125100875,-63.3217225343542,-62.9525597980319,-62.5955637527959,-62.2509660580487,-61.9189904535932,-61.5998526302150,-61.2937600988675,-61.0009120591639,-60.7214992678720,-60.4557039081153,-60.2036994599690,-59.9656505731412,-59.7417129424093,-59.5320331864773,-59.3367487308914,-59.1559876956426,-58.9898687880507,-58.8385012015051,-58.7019845206019,-58.5804086331884,-58.4738536497872,-58.3823898308338,-58.3060775221220,-58.2449670988058,-58.1990989182606,-58.1685032820614,-58.1532004072838,-58.1532004072838,-58.1685032820614,-58.1367304381078,-58.0731815714486,-57.9778503197730,-57.8507271275716,-57.6917992316186,-57.5010506414999,-57.2784621150914,-57.0240111288653,-56.7376718428732,-56.4194150602355,-56.0692081809328,-55.6870151496695,-55.2727963975538,-54.8265087773030,-54.3481054916570,-53.8375360146451,-53.2947460053212,-52.7196772135433,-52.1122673773364,-51.4724501113360,-50.8001547857678,-50.0953063953714,-49.3578254176279,-48.5876276595966,-47.7846240926131,-46.9487206740345,-46.0798181551549,-45.1778118743430,-44.2425915343741,-43.2740409628447,-42.2720378544672,-41.2364534939405,-40.1671524579825,-39.0639922949902,-37.9268231806595,-36.7554875477537,-35.5498196880445,-34.3096453242762,-33.0347811498035,-31.7250343333370,-30.3802019859875,-29.0000705875302,-27.5844153685098,-26.1329996444698,-24.6455740982149,-23.1218760055913,-21.5616283997973,-19.9645391687013,-18.3303000790428,-16.6585857207105,-14.9826158090840,-13.3022963096536,-11.6175300882862,-9.92821679592572,-8.23425274701537,-6.53553079122789,-4.83194017806166,-3.12336641382405,-1.40969111048414,0.309208174163498,2.03345810562785,3.76318975180188,5.49853877270070,7.23964562163320,8.98665575864200,10.7397198771267,12.4989941446413,14.2646404589518,16.0368267205324,17.8157271227965,19.6015224614741,21.3944004646860,23.1945561454144,25.0021921782366,26.7811359836429,28.5311353183900,30.2519301220597,31.9432526085584,33.6048273846386,35.2363715966756,36.8375951069488,38.4082007006641,39.9478843249381,41.4563353609250,42.9332369302205,44.3782662365986,45.7910949440524,47.1713895919934,48.5188120483318,49.8330200009987,51.1136674882933,52.3604054682278,53.5728824268091,54.7507450249421,55.8936387833566,57.0012088046531,58.0731005312365,59.1089605375600,60.1084373547364,61.0711823251951,61.9968504846749,62.8851014684478,63.7356004382753,64.5480190262031,65.3220362909277,66.0573396820992,66.7536260075924,67.4106023984629,68.0279872660454,68.6055112454166,69.1429181192793,69.6399657162033,70.0964267771050,70.5120897838651,70.8867597440648,71.2202589259762,71.5124275381805,71.7631243484877,71.9722272372112,72.1396336802975,72.2652611583239,72.3490474879406,72.3909510729613,72.3909510729613,72.3490474879406,72.3909510729613,72.4116824661879,72.4116824661879,72.3909510729613,72.3495144250062,72.2874247167663,72.2047600342540,72.1016241102956,71.9781460015397,71.8344796900327,71.6708036127858,71.4873201233268,71.2842548897461,71.0618562341836,70.8203944190940,70.5601608859220,70.2814674520587,69.9846454721009,69.6700449695253,69.3380337448978,68.9889964666828,68.6233337506043,68.2414612333335,67.8438086460470,67.4308188931377,67.0029471410410,66.5606599218067,66.1044342556771,65.6347567965528,65.1521230038323,64.6570363437148,64.1500075226590,63.6315537552957,63.1021980687129,62.5624686446634,62.0128982008928,61.4540234124561,60.8863843735791,60.3105241003386,59.7269880741663,59.1363238259512,58.5390805602962,57.9358088192989,57.3270601850608,56.7133870199890,56.0953422438302,55.4734791462855,54.8483512339623,54.2205121103732,53.5905153876306,52.9589146284664,52.3262633171822,51.6931148581330,51.0723139586509,50.4636753588981,49.8670214014417,49.2821816509599,48.7089925381911,48.1472970262589,47.5969442976667,47.0577894604121,46.5296932718032,46.0125218786822,45.5061465728741,45.0104435607722,44.5252937460673,44.0505825247075,43.5861995912476,43.1320387558144,42.6879977709793,42.2539781678783,41.8298851009752,41.4156272009080,41.0111164349003,40.6162679742593,40.2310000685147,39.8552339257885,39.4961285104872,39.1530626969326,38.8254370509388,38.5126728833112,38.2142113800020,37.9295128021004,37.6580557495236,37.3993364828818,37.1528682985359,36.9181809523423,36.6948201280118,36.4823469463890,36.2803375123034,36.0883824959459,35.9060867460032,35.7330689320277,35.5689612137420,35.4134089351812,35.2660703417541,35.1266163184705,34.9947301477299,34.8701072852033,34.7524551524590,34.6414929451009,34.5369514552843,34.4385729075696,34.3461108071614,34.2593297996548,34.1780055414847,34.1019245803408,34.0308842448677,33.9646925430299,33.9031680685696,33.8461399150358,33.7934475969041,33.7449409773520,33.7004802022890,33.6599356402773,33.6231878280162,33.5901274210872,33.5606551496945,33.5346817791560,33.5121280749332,33.4929247720066,33.4770125484329,33.4643420029395,33.4548736364353,33.4485778373376,33.4103096388886,33.4454348706365,33.4454348706365,33.4103096388886,33.3400626018341,33.2347005979798,33.0942338491974,32.9186759177889,32.7080436494647,32.4623571024196,32.1816394627411,31.8659169464252,31.5152186883172,31.1295766183323,30.7090253253510,30.2536019092115,29.7633458212626,29.2382986939580,28.6785041600075,28.0840076616156,27.4548562503621,26.7910983782924,26.0927836807982,25.3599627518782,24.5926869123768,23.7910079717972,22.9549779842931,22.0846489994296,21.1800728083116,20.2413006856587,19.2683831284033,18.2613695913716,17.2203082205982,16.1452455848028,15.0362264055480,13.8932932865734,12.7164864427841,11.5058434293540,10.2613988713801,8.98318419450881,7.67122735693020,6.32555258312100,4.94618009969390,3.53312587369573,2.08640135367690,0.606013213841271,-0.908036898432499,-2.45575261141633,-4.03714307393832,-5.65222319610630,-7.30101388559918,-8.98354227927624,-10.6998419698583,-12.4156418374985,-14.1310130412984,-15.8460255305869,-17.5607480751783,-19.2752482942003,-20.9895926835466,-22.7038466420119,-24.4180744961556,-26.1323395239466,-27.8467039772312,-29.5612291030690,-31.2759751639762,-32.9910014571144,-34.7063663324620,-36.4221272100018,-38.1383405959572,-39.8550620981063,-41.5723464402053,-43.2902474755466,-45.0088181996775,-46.7281107623047,-48.4481764784079,-50.1690658385829,-51.8908285186367,-53.5790503413588,-55.2337209848318,-56.8548252024191,-58.4423432403117,-59.9962512346165,-61.5165215890327,-63.0031233340849,-64.4560224688116,-65.8751822857495,-67.2605636799903,-68.6121254430454,-69.9298245421958,-71.2136163859770,-72.4634550763996,-73.6792936484750,-74.8610842975900,-76.0087785952382,-77.1223276935938,-78.2016825193914,-79.2467939575489,-80.2576130249563,-81.2340910348271,-82.1761797520009,-83.0838315395605,-83.9569994971178,-84.7956375911051,-85.5997007773944,-86.3691451165577,-87.1039278820619,-87.8040076616855,-88.4693444524295,-89.0998997491821,-89.6956366273864,-90.2565198199468,-90.7825157886015,-91.2735927899716,-91.7297209364909,-92.1508722524029,-92.5370207250061,-92.8881423513116,-93.2042151802643,-93.4852193506762,-93.7311371249901,-93.9419529190002,-94.1176533276282,-94.2582271468458,-94.3636653918243,-94.4339613113754};
//float ref2[]={117.703430612456,117.689870661727,117.669525937771,117.642390682117,117.608457215072,117.567715934205,117.520155312434,117.465761895684,117.404520300090,117.336413208734,117.261421367870,117.179523582596,117.090696711962,116.994915663431,116.892153386680,116.782380866663,116.665567115890,116.541679165859,116.410682057575,116.272538831071,116.127210513874,115.974656108317,115.814832577612,115.647694830594,115.473195705028,115.291285949381,115.101914202924,114.905026974076,114.700568616825,114.488481305114,114.268705005030,114.041177444656,113.805834081404,113.562608066668,113.311430207607,113.052228925849,112.784930212931,112.509457582219,112.225732017092,111.933671915130,111.633193028032,111.324208396964,111.006628283053,110.680360092668,110.345308297146,110.001374346577,109.648456577245,109.286450112280,108.915246755039,108.534734874731,108.152462750130,107.768420187746,107.382596653732,106.994981267220,106.605562793415,106.214329636416,105.821269831786,105.426371038819,105.029620532531,104.631005195337,104.230511508406,103.828125542694,103.423832949618,103.017618951377,102.609468330891,102.199365421345,101.787294095321,101.373237753503,100.957179312923,100.539101194746,100.118985311555,99.6968130541233,99.2725652776451,98.8462222874034,98.4263538585721,98.0130653656502,97.6064614766077,97.2066461227398,96.8137224648562,96.4277928558822,96.0489587999624,95.6773209081591,95.3129788508483,94.9560313069235,94.6065759099236,94.2647091912143,93.9305265203574,93.6041220428130,93.2855886151315,92.9750177377978,92.6724994859043,92.3781224378342,92.0919736021533,91.8141383429085,91.5447003035516,91.2837413297055,91.0313413910064,90.7875785022586,90.5525286441496,90.3262656837762,90.1088612952420,89.9003848805884,89.7009034913280,89.5104817508504,89.3291817779729,89.1570631119105,88.9941826389355,88.8405945210008,88.6963501265913,88.5614979640689,88.4360836177659,88.3201496870781,88.2137357287968,88.1168782029115,88.0296104220998,87.9519625051138,87.8839613342503,87.8256305170848,87.7769903526268,87.7380578020386,87.7088464640421,87.6893665551174,87.6796248945761,87.6796248945761,87.6893665551174,87.6826216779568,87.6691290218830,87.6488827812840,87.6218742424653,87.5880917772935,87.5475208346801,87.5001439298691,87.4459406314841,87.3848875462804,87.3169583015372,87.2421235250169,87.1603508224042,87.0716047521323,86.9758467974846,86.8730353358569,86.7631256050427,86.6460696663997,86.5218163647343,86.3903112847292,86.2514967037214,86.1053115406208,85.9516913007408,85.7905680162900,85.6218701822563,85.4455226873858,85.2614467399380,85.0695597878664,84.8697754330481,84.6620033391473,84.4461491326675,84.2221142967031,83.9897960568599,83.7490872587673,83.4998762365511,83.2420466715813,82.9754774407433,82.7000424534135,82.4156104762434,82.1220449447696,81.8192037607745,81.5069390742171,81.1850970484350,80.8535176071920,80.5120341619970,80.1604733179589,79.7986545562604,79.4263898911273,79.0434834989418,78.6497313168861,78.2449206082122,77.8370193051277,77.4259886465609,77.0117886002762,76.5943778123077,76.1737135537182,75.7497516645076,75.3224464944815,74.8917508408760,74.4576158825173,74.0199911102785,73.5788242535748,73.1340612026167,72.6856459261191,72.2335203841358,71.7776244356629,71.3178957406192,70.8542696557832,70.3866791242204,69.9150545577001,69.4393237115471,68.9594115513259,68.4752401106976,67.9867283397206,67.4937919428023,67.0063369856210,66.5245454913358,66.0486011094005,65.5786890850303,65.1149962174848,64.6577108065810,64.2070225868484,63.7631226487462,63.3262033463743,62.8964581911303,62.4740817307868,62.0592694135018,61.6522174363120,61.2531225777142,60.8621820139965,60.4795931190528,60.1055532474962,59.7402595009722,59.3839084776808,59.0366960052242,58.6988168570191,58.3704644526458,58.0518305426489,57.7431048784508,57.4444748681976,57.1561252195230,56.8782375703759,56.6109901092351,56.3545571861968,56.1091089165937,55.8748107789639,55.6518232093444,55.4403011940092,55.2403938629035,55.0522440861398,54.8759880760202,54.7117549971222,54.5596665870345,54.4198367903544,54.2923714085514,54.1773677682652,54.0749144105409,53.9850908034045,53.9079670800498,53.8436038047507,53.7920517684172,53.7533518154986,53.7275347036943,53.7146209976663,53.7146209976663,53.7275347036943,53.7146209976663,53.7017049292725,53.7017049292725,53.7146209976663,53.7404428281973,53.7791498442309,53.8307112702006,53.8950862380052,53.9722239274418,54.0620637394786,54.1645355009063,54.2795596986611,54.4070477418985,54.5469022497017,54.6990173621494,54.8632790723377,55.0395655768489,55.2277476420976,55.4276889839435,55.6392466579589,55.8622714577594,56.0966083188587,56.3420967255794,56.5985711186533,56.8658613012550,57.1437928413492,57.4321874683734,57.7308634624368,58.0396360343764,58.3583176951814,58.6867186134650,59.0246469598335,59.3719092371699,59.7283105960123,60.0936551343632,60.4677461814179,60.8503865648406,61.2413788613471,61.6405256304793,62.0476296315660,62.4624940239646,62.8849225507735,63.3147197062806,63.7516908874876,64.1956425301057,64.6463822294742,65.1037188468899,65.5674626018741,66.0374251509255,66.5134196533287,66.9952608245997,67.4827649781546,67.9757500557924,68.4643090294684,68.9485262491936,69.4284828165519,69.9042567469295,70.3759231213787,70.8435542289153,71.3072196999760,71.7669866316972,72.2229197056204,72.6750812983770,73.1235315858562,73.5683286413213,74.0095285278972,74.4471853858194,74.8813515148041,75.3120774518671,75.7394120448976,76.1634025222649,76.5840945587182,77.0015323378182,77.4157586111199,77.8268147543137,78.2347408205123,78.6395755908600,79.0333506914306,79.4162789160598,79.7885643811815,80.1504029608082,80.5019826881157,80.8434841265380,81.1750807129877,81.4969390755569,81.8092193278206,82.1120753416649,82.4056550003731,82.6901004335468,82.9655482352892,83.2321296669487,83.4899708456056,83.7391929193768,83.9799122305228,84.2122404672522,84.4362848050450,84.6521480382443,84.8599287026055,85.0597211894306,85.2516158518696,85.4356991039163,85.6120535125892,85.7807578837440,85.9418873419309,86.0955134046763,86.2417040515357,86.3805237882418,86.5120337062404,86.6362915378865,86.7533517075505,86.8632653788627,86.9660804983061,87.0618418353516,87.1505910193093,87.2323665730585,87.3072039438013,87.3751355309733,87.4361907114302,87.4903958620190,87.5377743796286,87.5783466988060,87.6121303070113,87.6391397575774,87.6593866804267,87.6728797905920,87.6893665551174,87.6796248945761,87.6796248945761,87.6893665551174,87.7088464640421,87.7380578020386,87.7769903526268,87.8256305170848,87.8839613342503,87.9519625051138,88.0296104220998,88.1168782029115,88.2137357287968,88.3201496870781,88.4360836177659,88.5614979640689,88.6963501265913,88.8405945210008,88.9941826389355,89.1570631119105,89.3291817779729,89.5104817508504,89.7009034913280,89.9003848805884,90.1088612952420,90.3262656837762,90.5525286441496,90.7875785022586,91.0313413910064,91.2837413297055,91.5447003035516,91.8141383429085,92.0919736021533,92.3781224378342,92.6724994859043,92.9750177377978,93.2855886151315,93.6041220428130,93.9305265203574,94.2647091912143,94.6065759099236,94.9560313069235,95.3129788508483,95.6773209081591,96.0489587999624,96.4277928558822,96.8137224648562,97.2066461227398,97.6064614766077,98.0130653656502,98.4263538585721,98.8462222874034,99.2725652776451,99.6968130541233,100.118985311555,100.539101194746,100.957179312923,101.373237753503,101.787294095321,102.199365421345,102.609468330891,103.017618951377,103.423832949618,103.828125542694,104.230511508406,104.631005195337,105.029620532531,105.426371038819,105.821269831786,106.214329636416,106.605562793415,106.994981267220,107.382596653732,107.768420187746,108.152462750130,108.534734874731,108.915246755039,109.286450112280,109.648456577245,110.001374346577,110.345308297146,110.680360092668,111.006628283053,111.324208396964,111.633193028032,111.933671915130,112.225732017092,112.509457582219,112.784930212931,113.052228925849,113.311430207607,113.562608066668,113.805834081404,114.041177444656,114.268705005030,114.488481305114,114.700568616825,114.905026974076,115.101914202924,115.291285949381,115.473195705028,115.647694830594,115.814832577612,115.974656108317,116.127210513874,116.272538831071,116.410682057575,116.541679165859,116.665567115890,116.782380866663,116.892153386680,116.994915663431,117.090696711962,117.179523582596,117.261421367870,117.336413208734,117.404520300090,117.465761895684,117.520155312434,117.567715934205,117.608457215072,117.642390682117,117.669525937771,117.689870661727,117.703430612456};


//Configuracion de puertos E/S, Serial e interrupciones
void setup() {
  Serial.begin(2000000);
  attachInterrupt(digitalPinToInterrupt(pinCanalA),Encoder,RISING);
  pinMode(pinCanalA, INPUT_PULLUP);
  pinMode(pinCanalB, INPUT_PULLUP);

  pinMode(motorPin1,OUTPUT);
  pinMode(motorPin2,OUTPUT);

  attachInterrupt(digitalPinToInterrupt(pinCanalA2),Encoder2,RISING);
  pinMode(pinCanalA2, INPUT_PULLUP);
  pinMode(pinCanalB2, INPUT_PULLUP);

  pinMode(motorPin12,OUTPUT);
  pinMode(motorPin22,OUTPUT);

  
  //discretizar el PID
  kp2 = 1.00;
  ki2 = 5.90;
  kd2 = 0.5;
  kp2 = 10;
  ki2 = 25.90;
  kd2 = 0.9;
  Ts = 0.01; //20 milisegundos

  kp = 10.0;
  ki = 25.80;
  kd = 0.9;

  kp = 10.5;
  ki = 25.80;
  kd = 0.1;


  // Ganancias del modelo discreto
  K1 = kp + Ts*ki + kd/Ts;
  K2 = -kp - 2.0*kd/Ts;
  K3 = kd/Ts;

  K12 = kp2 + Ts*ki2 + kd2/Ts;
  K22 = -kp2 - 2.0*kd2/Ts;
  K32 = kd2/Ts;
}



void loop() {
  
 if(micros()-tiempo>5000)
 {
  tiempo=micros();

  if(flagx == 1){
  indexref++;
  if(indexref == 1)
  {
    indexref = 0;
    indexr++;
    }
  }

 //if(indexr > 499) //cuadrado
 if(indexr > 314) //circulo
 indexr = 0;
 
  referencia = -ref1[indexr];
  referencia2 = -ref2[indexr];

  //INICIO DE AREA DE CONTROL PID2
  e2[0]=referencia2 - contador2;
  u2[0]=K12*e2[0]+K22*e2[1]+K32*e2[2]+u2[1];
  if(u2[0]>255) u2[0]=255;
  if(u2[0]<-255) u2[0]=-255;
//corrimientos de muestras 
  e2[2]=e2[1];
  e2[1]=e2[0];
  u2[1]=u2[0];
  if (u2[0]>=0){
    analogWrite(motorPin12,(int)(u2[0]));
    analogWrite(motorPin22,0);
  }
  else{
    analogWrite(motorPin12,0);
    analogWrite(motorPin22,(int)(-u2[0]));
  }

  //INICIO DE AREA DE CONTROL PID1
  e[0]=referencia - contador;
  u[0]=K1*e[0]+K2*e[1]+K3*e[2]+u[1];
  if(u[0]>255) u[0]=255;
  if(u[0]<-255) u[0]=-255;
  //corrimientos de muestras
  e[2]=e[1];
  e[1]=e[0];
  u[1]=u[0];

  if (u[0]>=0){
    analogWrite(motorPin1,(int)(u[0]));
    analogWrite(motorPin2,0);
  }
  else{
    analogWrite(motorPin1,0);
    analogWrite(motorPin2,(int)(-u[0]));
  }

  Serial.print(referencia);
  Serial.print("    ");
  Serial.print(contador);
  Serial.print("    ");
  Serial.print(u[0]);
  Serial.print("    ");
  Serial.print(e[0]);
  Serial.print("       ");
  Serial.print(referencia2);
  Serial.print("    ");
  Serial.print(contador2);
  Serial.print("    ");
  Serial.print(u2[0]);
  Serial.print("    ");
  Serial.println(e2[0]);
 }

}

//Interrupcion de Encoder 1
void Encoder()
{
  if (digitalRead(pinCanalA)==digitalRead(pinCanalB)){
    contador++;}
    else{
      contador--;}
}

// Interrupción de enconder 2
void Encoder2()
{
  if (digitalRead(pinCanalA2)==digitalRead(pinCanalB2)){
    contador2++;}
    else{
      contador2--;}
}


unsigned int index;
void serialEvent()
{             
    char ch = Serial.read();   
    refstring.concat(ch); 
    if(refstring.charAt(index) == '\n' && refstring.charAt(index-1) == '\r')
    {
      index = 0;
      //referencia = refstring.toFloat();
      //referencia2 = referencia;
      refstring = "";
      flagx = 1;
      }   
    else{
    index++;
    }
}
